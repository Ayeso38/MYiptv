<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamView - M3U Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide Icons as SVG components
        const Play = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const Volume2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const VolumeX = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <line x1="23" y1="9" x2="17" y2="15"></line>
                <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
        );

        const Maximize = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
        );

        const Monitor = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
        );

        const List = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        );

        const Loader = () => (
            <svg className="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
            </svg>
        );

        const Film = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                <line x1="7" y1="2" x2="7" y2="22"></line>
                <line x1="17" y1="2" x2="17" y2="22"></line>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <line x1="2" y1="7" x2="7" y2="7"></line>
                <line x1="2" y1="17" x2="7" y2="17"></line>
                <line x1="17" y1="17" x2="22" y2="17"></line>
                <line x1="17" y1="7" x2="22" y2="7"></line>
            </svg>
        );

        function StreamPlayer() {
            const [playlistUrl, setPlaylistUrl] = useState('https://mifntechnology.github.io/siaranMy/myIPtv.m3u8');
            const [channels, setChannels] = useState([]);
            const [currentChannel, setCurrentChannel] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [volume, setVolume] = useState(1);
            const [isMuted, setIsMuted] = useState(false);
            const [showControls, setShowControls] = useState(true);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const videoRef = useRef(null);
            const controlsTimeoutRef = useRef(null);

            useEffect(() => {
                if (videoRef.current) {
                    videoRef.current.volume = volume;
                }
            }, [volume]);

            const parseM3U = (content) => {
                const lines = content.split('\n');
                const parsedChannels = [];
                let currentInfo = {};

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('#EXTINF:')) {
                        const nameMatch = line.match(/,(.+)$/);
                        const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                        const groupMatch = line.match(/group-title="([^"]+)"/);
                        
                        currentInfo = {
                            name: nameMatch ? nameMatch[1].trim() : 'Unknown Channel',
                            logo: logoMatch ? logoMatch[1] : null,
                            group: groupMatch ? groupMatch[1] : 'Other'
                        };
                    } else if (line && !line.startsWith('#') && currentInfo.name) {
                        parsedChannels.push({
                            ...currentInfo,
                            url: line
                        });
                        currentInfo = {};
                    }
                }

                return parsedChannels;
            };

            const handleLoadPlaylist = async () => {
                if (!playlistUrl.trim()) {
                    setError('Please enter a valid M3U playlist URL');
                    return;
                }

                setLoading(true);
                setError('');
                
                try {
                    const response = await fetch(playlistUrl);
                    if (!response.ok) throw new Error('Failed to fetch playlist');
                    
                    const content = await response.text();
                    const parsed = parseM3U(content);
                    
                    if (parsed.length === 0) {
                        setError('No channels found in playlist');
                    } else {
                        setChannels(parsed);
                        setError('');
                    }
                } catch (err) {
                    setError('Failed to load playlist. Please check the URL or try a different playlist.');
                } finally {
                    setLoading(false);
                }
            };

            const playChannel = (channel) => {
                setCurrentChannel(channel);
                setIsPlaying(true);
                setError('');
            };

            const togglePlay = () => {
                if (videoRef.current) {
                    if (isPlaying) {
                        videoRef.current.pause();
                    } else {
                        videoRef.current.play().catch(err => {
                            setError('Failed to play stream. Channel may be offline.');
                        });
                    }
                    setIsPlaying(!isPlaying);
                }
            };

            const toggleMute = () => {
                if (videoRef.current) {
                    videoRef.current.muted = !isMuted;
                    setIsMuted(!isMuted);
                }
            };

            const toggleFullscreen = () => {
                if (videoRef.current) {
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    } else {
                        videoRef.current.requestFullscreen();
                    }
                }
            };

            const handleMouseMove = () => {
                setShowControls(true);
                if (controlsTimeoutRef.current) {
                    clearTimeout(controlsTimeoutRef.current);
                }
                controlsTimeoutRef.current = setTimeout(() => {
                    if (isPlaying) setShowControls(false);
                }, 3000);
            };

            const filteredChannels = channels.filter(ch => 
                ch.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                    {/* Header */}
                    <div className="bg-black/30 backdrop-blur-md border-b border-white/10">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <Monitor />
                                    <h1 className="text-2xl font-bold text-white">StreamView</h1>
                                </div>
                                <nav className="flex items-center gap-2">
                                    <a
                                        href="index.html"
                                        className="px-4 py-2 bg-purple-600 text-white rounded-lg transition-all text-sm font-medium hover:bg-purple-700"
                                    >
                                        <div className="flex items-center gap-2">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                                <line x1="12" y1="17" x2="12" y2="21"></line>
                                            </svg>
                                            <span className="hidden sm:inline">Stream</span>
                                        </div>
                                    </a>
                                    <a
                                        href="video.html"
                                        className="px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all text-sm font-medium"
                                    >
                                        <div className="flex items-center gap-2">
                                            <Film />
                                            <span className="hidden sm:inline">Video</span>
                                        </div>
                                    </a>
                                     <a
                                        href="radio.html"
                                        className="px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-all text-sm font-medium"
                                    >
                                        <div className="flex items-center gap-2">
                                            <Film />
                                            <span className="hidden sm:inline">Radio</span>
                                        </div>
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto px-4 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Sidebar - Channel List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 shadow-2xl">
                                    <div className="mb-4">
                                        <label className="block text-white text-sm font-medium mb-3">
                                            M3U Playlist URL
                                        </label>
                                        <div className="flex flex-col gap-3">
                                            <input
                                                type="text"
                                                value={playlistUrl}
                                                onChange={(e) => setPlaylistUrl(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && handleLoadPlaylist()}
                                                placeholder="https://example.com/playlist.m3u"
                                                className="w-full px-4 py-3 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                                            />
                                            <button
                                                onClick={handleLoadPlaylist}
                                                disabled={loading}
                                                className="w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50 flex items-center justify-center gap-2"
                                            >
                                                {loading ? <Loader /> : <List />}
                                                {loading ? 'Loading...' : 'Load Channels'}
                                            </button>
                                        </div>
                                    </div>

                                    {channels.length > 0 && (
                                        <>
                                            <input
                                                type="text"
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                placeholder="Search channels..."
                                                className="w-full px-4 py-2 mb-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                                            />
                                            
                                            <div className="space-y-2 max-h-96 overflow-y-auto scrollbar-thin pr-2">
                                                <p className="text-gray-400 text-xs mb-2">
                                                    {filteredChannels.length} channels
                                                </p>
                                                {filteredChannels.map((channel, idx) => (
                                                    <button
                                                        key={idx}
                                                        onClick={() => playChannel(channel)}
                                                        className={`w-full text-left p-3 rounded-xl transition-all ${
                                                            currentChannel?.url === channel.url
                                                                ? 'bg-purple-600 text-white'
                                                                : 'bg-white/5 hover:bg-white/10 text-gray-300'
                                                        }`}
                                                    >
                                                        <div className="flex items-center gap-3">
                                                            {channel.logo ? (
                                                                <img 
                                                                    src={channel.logo} 
                                                                    alt={channel.name}
                                                                    className="w-10 h-10 object-cover rounded"
                                                                    onError={(e) => e.target.style.display = 'none'}
                                                                />
                                                            ) : (
                                                                <div className="w-10 h-10 bg-purple-500/30 rounded flex items-center justify-center text-xs">
                                                                    TV
                                                                </div>
                                                            )}
                                                            <div className="flex-1 min-w-0">
                                                                <p className="font-medium truncate text-sm">{channel.name}</p>
                                                                <p className="text-xs opacity-70 truncate">{channel.group}</p>
                                                            </div>
                                                        </div>
                                                    </button>
                                                ))}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>

                            {/* Main Player */}
                            <div className="lg:col-span-2">
                                {error && (
                                    <div className="mb-4 p-4 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-sm">
                                        {error}
                                    </div>
                                )}

                                <div className="relative bg-black rounded-2xl overflow-hidden shadow-2xl border border-white/10">
                                    <div 
                                        className="relative aspect-video bg-black"
                                        onMouseMove={handleMouseMove}
                                        onMouseLeave={() => isPlaying && setShowControls(false)}
                                    >
                                        {currentChannel ? (
                                            <>
                                                <video
                                                    ref={videoRef}
                                                    className="w-full h-full"
                                                    src={currentChannel.url}
                                                    autoPlay
                                                    onError={() => setError('Failed to load stream. Channel may be offline or incompatible.')}
                                                />
                                                
                                                {/* Channel Info Overlay */}
                                                <div className={`absolute top-0 left-0 right-0 bg-gradient-to-b from-black/90 to-transparent p-6 transition-opacity duration-300 ${
                                                    showControls ? 'opacity-100' : 'opacity-0'
                                                }`}>
                                                    <div className="flex items-center gap-3">
                                                        {currentChannel.logo && (
                                                            <img 
                                                                src={currentChannel.logo} 
                                                                alt={currentChannel.name}
                                                                className="w-12 h-12 object-cover rounded"
                                                            />
                                                        )}
                                                        <div>
                                                            <h3 className="text-white font-semibold">{currentChannel.name}</h3>
                                                            <p className="text-gray-400 text-sm">{currentChannel.group}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        ) : (
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="text-center">
                                                    <div className="mx-auto mb-4 text-purple-400/30">
                                                        <Monitor />
                                                    </div>
                                                    <p className="text-gray-400 text-lg">
                                                        {channels.length > 0 
                                                            ? 'Select a channel to start watching'
                                                            : 'Load a playlist to view channels'
                                                        }
                                                    </p>
                                                </div>
                                            </div>
                                        )}

                                        {/* Controls Overlay */}
                                        {currentChannel && (
                                            <div 
                                                className={`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-6 transition-opacity duration-300 ${
                                                    showControls ? 'opacity-100' : 'opacity-0'
                                                }`}
                                            >
                                                <div className="flex items-center gap-4">
                                                    <button
                                                        onClick={togglePlay}
                                                        className="p-3 bg-white/20 hover:bg-white/30 rounded-full transition-all backdrop-blur-sm"
                                                    >
                                                        {isPlaying ? <Pause /> : <Play />}
                                                    </button>

                                                    <div className="flex items-center gap-2 flex-1">
                                                        <button
                                                            onClick={toggleMute}
                                                            className="p-2 hover:bg-white/20 rounded-lg transition-all"
                                                        >
                                                            {isMuted ? <VolumeX /> : <Volume2 />}
                                                        </button>
                                                        <input
                                                            type="range"
                                                            min="0"
                                                            max="1"
                                                            step="0.1"
                                                            value={isMuted ? 0 : volume}
                                                            onChange={(e) => {
                                                                const val = parseFloat(e.target.value);
                                                                setVolume(val);
                                                                if (val > 0) setIsMuted(false);
                                                            }}
                                                            className="w-24"
                                                        />
                                                    </div>

                                                    <button
                                                        onClick={toggleFullscreen}
                                                        className="p-2 hover:bg-white/20 rounded-lg transition-all ml-auto"
                                                    >
                                                        <Maximize />
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Info Section */}
                                <div className="mt-6 bg-white/5 backdrop-blur-lg rounded-2xl p-6 border border-white/10">
                                    <h2 className="text-white font-semibold mb-3">How to Use</h2>
                                    <ul className="text-gray-300 space-y-2 text-sm">
                                        <li>• The Malaysia channels playlist is already loaded by default</li>
                                        <li>• Click "Load Channels" to load the playlist</li>
                                        <li>• Browse and search for channels in the sidebar</li>
                                        <li>• Click any channel to start watching</li>
                                        <li>• You can paste any other M3U playlist URL to load different channels</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<StreamPlayer />, document.getElementById('root'));
    </script>
</body>
</html>
